<div class="data-table-container h-full">
  @if (loading()) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }

  <div class="table-wrapper">
    <table mat-table [dataSource]="data()" matSort (matSortChange)="onSortChange($event)">
      @for (column of columns(); track column.key) {
        <ng-container [matColumnDef]="column.key">
          <th mat-header-cell *matHeaderCellDef
              [mat-sort-header]="column.sortable !== false ? column.key : ''"
              [disabled]="column.sortable === false"
              [style.width]="column.width || 'auto'"
              [style.text-align]="column.align || 'left'">
            {{ column.label }}
          </th>
          <td mat-cell *matCellDef="let row"
              [style.text-align]="column.align || 'left'">
            {{ getCellValue(row, column) }}
          </td>
        </ng-container>
      }

      @if (showActions()) {
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef style="width: 100px; text-align: center;">
            Ações
          </th>
          <td mat-cell *matCellDef="let row" style="text-align: center;">
            @if (showViewAction()) {
              <button mat-icon-button
                      matTooltip="Visualizar"
                      (click)="onView(row)">
                <mat-icon>visibility</mat-icon>
              </button>
            }
            <button mat-icon-button color="primary"
                    matTooltip="Editar"
                    (click)="onEdit(row)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn"
                    matTooltip="Excluir"
                    (click)="onRemove(row)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns(); sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns();"
          class="table-row"></tr>
    </table>

    @if (data().length === 0 && !loading()) {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <span>Nenhum registro encontrado</span>
      </div>
    }
  </div>

  <mat-paginator
    [length]="totalElements()"
    [pageSize]="pageSize()"
    [pageIndex]="pageIndex()"
    [pageSizeOptions]="pageSizeOptions()"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>
</div>
