<div class="filter-container">
  <div class="filter-header" (click)="toggleExpanded()">
    <div class="filter-title">
      <mat-icon>filter_list</mat-icon>
      <span>Filtros</span>
      @if (activeFilterCount() > 0) {
        <span class="filter-badge">{{ activeFilterCount() }}</span>
      }
    </div>
    <mat-icon class="expand-icon" [class.expanded]="expanded()">expand_more</mat-icon>
  </div>

  <div class="filter-body" [class.collapsed]="!expanded()">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      @for (field of fields(); track field.key) {
        @if (field.type === 'text') {
          <app-input
            [label]="field.label"
            [placeholder]="field.placeholder || ''"
            [ngModel]="values()[field.key] || ''"
            (ngModelChange)="onFieldChange(field.key, $event)"
          ></app-input>
        }
        @if (field.type === 'select') {
          <app-select
            [label]="field.label"
            [options]="getAllOptions(field)"
            [ngModel]="values()[field.key]"
            (ngModelChange)="onFieldChange(field.key, $event)"
          ></app-select>
        }
      }
    </div>

    <div class="flex gap-2 mt-2 justify-end">
      <app-button
        label="Buscar"
        icon="search"
        color="primary"
        variant="raised"
        (clicked)="onSearch()">
      </app-button>
      <app-button
        label="Limpar"
        icon="clear"
        variant="stroked"
        (clicked)="onClear()">
      </app-button>
    </div>
  </div>
</div>
